


<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]<!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="UTF-8">

    <title>
        A Refactor Session For Re-education In ThoughtWorks
 - Terr Tai's Blog
    </title>

    <meta name="description" content="Terry Tai is on his way!">
    <meta name="keywords" content="  ["refactor"]
">
    <meta name="author" content="poshboytl">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="cleartype" content="on">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="apple-touch-icon-precomposed" type="image/png" sizes="57x57" href="/apple-touch-icon-57x57-precomposed.png">
    <link rel="apple-touch-icon-precomposed" type="image/png" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" type="image/png" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" type="image/png" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon-precomposed.png">
    <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">

    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png">
    <link rel="shortcut icon" sizes="16x16" href="/favicon.ico">
    <link rel="alternate" type="application/rss+xml" title="Terr Tai's Homepage" href="/feed.xml" />
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/stylesheets/application.css?1392274338" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/application.js?1392274337" type="text/javascript"></script>

  </head>
  <body class="a-refactor-session-for-re-education-in-thoughtworks a-refactor-session-for-re-education-in-thoughtworks_index">
    <aside class="sidebar">
      <h1 class="site-name"><a href="/">Terry</a></h1>
      <nav class="global-nav">
        <ul>
          <li><a href="/">Posts</a></li>
          <li><a href="#TODO">Photos</a></li>
          <li><a href="/profile">Profile</a></li>
        </ul>        
      </nav>

      <nav class="social-connect">
        <ul>
          <li><a href="//weibo.com/poshboytl"><i class="icon-weibo"></i></a></li>
          <li><a href="//twitter.com/poshboytl"><i class="icon-twitter"></i></a></li>
          <li><a href="//facebook.com/terry.tai.man"><i class="icon-facebook"></i></a></li>
          <li><a href="/rss.xml"><i class="icon-rss"></i></a></li>
        </ul>
      </nav>
      
      <!-- Ad -->
      <div class="block ad">
        <h4 class="block-title"><a href="//fengche.co/">Fengche.co</a></h4>
        <p class="block-cnt">团队协作工具</p>
      </div>

    </aside>

    <section class="main">
      <div class="container">
        
  <div class="announcement">
    <p>
      
        <img class="avatar" src="/images/terrytai.png" alt="Terry Tai" />
如果你的项目需要人帮助做架构, 重构或开发, 欢迎找我做咨询！联系方式: Skype: terrytie | QQ: 6123035

      
    </p>
  </div>

  <article class="post single">

    <header>
  <h2 class="title">
    <a href="/a-refactor-session-for-re-education-in-thoughtworks">A Refactor Session For Re-education In ThoughtWorks</a>
  </h2>
</header>

<aside class="aside-block">
  <ul class="meta">
    <!-- <li class="author-photo">
      <a href="http://terrytai.com">
        <img src="/images/terrytai.png?1392187460" />
      </a>
    </li>
    <li class="author">
     by Terry Tai
    </li> -->
    <li class="date">
      Mar 30, 2013
    </li>
    <li class="tags">
      
        <a href="/tags/refactor">refactor</a>
      
    </li>
  </ul>
</aside>

<div class="content">
  <h3>背景：</h3>

<p>前段时间受成都社区Lite的邀请，参与了<a href="https://github.com/twers/re-education">Re-education</a>的一些重构工作。这个项目是一个公益项目，它是一个老师的协作和交流平台，帮助老师更好的设计课程，从而让更多学校的学生受益。说来这也是我第一次参与公益项目的开发，也算是对公益事业尽一些绵薄之力吧。</p>

<p>这个项目目前已经上线<a href="http://newclass.org/">openclass.org</a>, 并且代码也已经<a href="https://github.com/twers/re-education">开源</a>。</p>

<p>之前这个项目主要是由 ThoughWorks 成都的几个工程师在负责开发和设计。同样也非常敬佩他们对公益事业的热衷和支持。</p>

<p>整个重构过程有我，<a href="http://yedingding.com/">Dingding</a>, Soloara参与，目前Rails端的重构， 已经基本告一段落。 而后我要离开成都一段时间，所以离开之前在ThoughtWorks做了一个Presentation。总结了一下整个重构过程，希望能对整个项目组有一定的帮助。</p>

<p>BTW: 还要特别感谢 Dingding 同学做了一次 Live Show 讲解重构代码中的一些细节。此次<a href="http://railscasts-china.com/episodes/refactor-openclass-by-dingding">Live Show的视频</a>也已经在<a href="http://railscasts-china.com/">Railscasts-china</a>发布了。</p>

<p>Keynote：</p>

<p>    <a href="https://speakerdeck.com/poshboytl/refactoring-re-education">https://speakerdeck.com/poshboytl/refactoring-re-education</a></p>

<h3>总结和解释：</h3>

<p>其中有几点需要注意一下:</p>

<ol>
<li> 一般在做重构的时候，特别是重构规模比较大的时候。通常内部接口是会发生变化的，所以unit tests通常是会failed的，而integration tests将是你正确重构下去的基础和保证。所以如果项目没有integration tests. 在重构之前添加上还是很有必要的。</li>
<li> Rspec or Cucumber都是写 integration tests 不错的选择，这取决于你团队的爱好。我选择 Rspec + Capybara只是一个个人爱好问题。</li>
<li> “Slim controllers, fat models” 这种提法在以前比较流行。但是已经越来越少有人提了，特别是“Fat models&quot;。的确很多项目的model已经太fat, 需要通过各种方式来进行减肥。 Concern也好，抽出到lib也好，都是不错的选择。但是我相信 slim controllers 仍然是永恒不变的，且值得遵守的。</li>
<li> 最后我也提到了一些开源项目工作流程上的问题。里面有说 &quot;Almost never push codes to master straightly. Create branch for every ticket.” 当时在讲到这里的时候引起了一些争论，主要争论点在给每个ticket建立branch有什么好处。我觉得好处主要还是更好利用pull request 做代码级别的沟通和review。更多相关的方法学可以参见Zack Holman的<a href="http://zachholman.com/talk/how-github-uses-github-to-build-github/">presentation</a>。不光是开源项目，我们在<a href="https://pragmatic.ly/">Pragmatic.ly</a>的开发中也是一直贯彻这种思想并且受益良多。</li>
</ol>

<p>最后，希望它对你有所帮助。</p>

<p>Keep rocking…</p>

</div>


  </article>

  <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'terrytaiblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>

      </div>
    </section>
    
    <footer>
      <div class="copyright">
        <p>&copy;2013 Terry Tai</p>
      </div>
    </footer>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-103363-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </body>
</html>
